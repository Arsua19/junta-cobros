<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import {
    getFirestore, collection, getDocs, query, orderBy
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAapctHWYLZQB2AJq93PaHIO8a-D525h84",
    authDomain: "junta-cobros.firebaseapp.com",
    projectId: "junta-cobros",
    storageBucket: "junta-cobros.appspot.com",
    messagingSenderId: "114984888186",
    appId: "1:114984888186:web:f526903357bb8039d618c3"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const tabla = document.getElementById("tablaCliente");
  const totalDiv = document.getElementById("totalPagado");
  const totalDiasDiv = document.getElementById("totalDias");

  async function cargarRegistros() {
    tabla.innerHTML = "";
    let totalMonto = 0;
    let totalDias = 0;

    const q = query(collection(db, "registrosCobro"), orderBy("fecha"));
    const snapshot = await getDocs(q);

    snapshot.forEach(doc => {
      const data = doc.data();

      // ⚠️ Validación segura para evitar errores
      let fechaTexto = "Sin fecha";
      if (data.fecha && typeof data.fecha.toDate === "function") {
        fechaTexto = data.fecha.toDate().toISOString().split("T")[0];
      }

      const monto = data.pago === "Sí" ? parseFloat(data.monto) : 0;
      const diasPagados = data.pago === "Sí" ? Math.floor(monto / 70) : 0;

      totalMonto += monto;
      totalDias += diasPagados;

      const fila = document.createElement("tr");
      fila.className = data.pago === "Sí" ? "pago" : "no-pago";

      fila.innerHTML = `
        <td>${fechaTexto}</td>
        <td>${data.dia}</td>
        <td>${data.pago}</td>
        <td>S/ ${monto.toFixed(2)}</td>
        <td>${diasPagados}</td>
      `;

      tabla.appendChild(fila);
    });

    totalDiv.textContent = `Total pagado: S/ ${totalMonto.toFixed(2)}`;
    totalDiasDiv.textContent = `Total de días pagados: ${totalDias}`;
  }

  cargarRegistros();
</script>


       
        
